<div class="d-flex">
  <!-- Main Content -->
  <div class="flex-grow-1 p-4 bg-light">
    <!-- Top Bar -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h3 class="fw-bold">Admin Dashboard</h3>

      <!-- Notification Bell -->
      <div class="position-relative me-3">
        <i class="bi bi-bell-fill fs-4 text-dark" style="cursor:pointer;"
           (click)="toggleNotifications()"></i>
        
        <!-- Badge for Unread Count -->
        <span *ngIf="unreadCount > 0"
              class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
          {{ unreadCount }}
        </span>

        <!-- Notifications Dropdown -->
        <div *ngIf="showNotifications"
             class="mt-2 p-3 border rounded bg-white shadow-lg position-absolute end-0"
             style="width:300px; max-height:350px; overflow-y:auto; z-index:1050;">
          
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h6 class="fw-bold mb-0">Notifications</h6>
            <button class="btn btn-sm btn-outline-danger py-0 px-2"
                    (click)="clearAllNotifications()">
              Clear All
            </button>
          </div>

          <div *ngIf="notifications.length > 0; else noNotifications">
            <div *ngFor="let n of notifications"
                 class="p-2 border-bottom notification-item d-flex justify-content-between align-items-start"
                 [ngClass]="{ 'fw-bold bg-light': !n.read }"
                 style="cursor:pointer;"
                 (click)="markAsRead(n)">
              
              <div>
                <small class="text-muted d-block">{{ n.timestamp | date:'short' }}</small>
                <span>{{ n.message }}</span>
              </div>

              <!-- Delete button -->
              <button class="btn btn-sm btn-outline-danger ms-2 py-0 px-1"
                      (click)="deleteNotification(n.id); $event.stopPropagation();">
                ‚úñ
              </button>
            </div>
          </div>

          <ng-template #noNotifications>
            <p class="text-muted small text-center mb-0">No notifications yet.</p>
          </ng-template>
        </div>
      </div>
    </div>

    <!-- Dashboard Summary Cards -->
    <div class="row mb-4">
      <div class="col-md-3">
        <div class="card shadow-sm border-0" (click)="activeTab = 'approved'" style="cursor:pointer;">
          <div class="card-body">
            <span class="text-primary small">Active Loans üí≥</span>
            <h3>{{approvedLoans.length}}</h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card shadow-sm border-0" (click)="activeTab = 'pending'" style="cursor:pointer;">
          <div class="card-body">
            <span class="text-warning small">Pending Loans ‚è≥</span>
            <h3>{{pendingLoans.length}}</h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card shadow-sm border-0" (click)="activeTab = 'rejected'" style="cursor:pointer;">
          <div class="card-body">
            <span class="text-danger small">Rejected Loans ‚ùå</span>
            <h3>{{rejectedLoans.length}}</h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card shadow-sm border-0" (click)="activeTab = 'repaid'" style="cursor:pointer;">
          <div class="card-body">
            <span class="text-success small">Fully Paid Loans üíµ</span>
            <h3>{{repaidLoans.length}}</h3>
          </div>
        </div>
      </div>
    </div>

    <div class="text-end mb-3">
      <button class="btn btn-primary" (click)="downloadReport()">üìÑ Download Report</button>
    </div>

    <!-- Charts Section -->
    <div class="row">
      <div class="col-md-6">
        <div class="card shadow-sm border-0">
          <div class="card-body">
            <h6 class="fw-bold">Funds(in / out)</h6>
            <canvas id="fundsChart"></canvas>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card shadow-sm border-0">
          <div class="card-body">
            <h6 class="fw-bold">Total Funds</h6>
            <canvas id="collectedChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Loan Tables -->
    <div id ="pendingLoans" *ngIf="activeTab === 'pending'">
      <h4>Pending Loans</h4>
      <table class="table table-bordered" *ngIf="pendingLoans.length > 0; else noPending">
        <thead>
          <tr><th>ID</th><th>User</th><th>Type</th><th>Amount</th><th>Action</th></tr>
        </thead>
        <tbody>
          <tr *ngFor="let loan of pendingLoans">
            <td>{{loan.id}}</td>
            <td>{{getUserName(loan.userId)}}</td>
            <td>{{loan.type}}</td>
            <td>{{loan.amount}}</td>
            <td>
              <button class="btn btn-success btn-sm" (click)="updateStatus(loan.id,'approved')">Approve</button>
              <button class="btn btn-danger btn-sm" (click)="updateStatus(loan.id,'rejected')">Reject</button>
            </td>
          </tr>
        </tbody>
      </table>
      <ng-template #noPending>
        <div class="alert alert-info small">No pending loan requests found.</div>
      </ng-template>
    </div>

    <div id="approvedLoans" *ngIf="activeTab === 'approved'">
      <h4>Approved Loans</h4>
      <table class="table table-bordered" *ngIf="approvedLoans.length > 0; else noApproved">
        <thead>
          <tr><th>ID</th><th>User</th><th>Type</th><th>Amount</th><th>Status</th></tr>
        </thead>
        <tbody>
          <tr *ngFor="let loan of approvedLoans">
            <td>{{loan.id}}</td>
            <td>{{getUserName(loan.userId)}}</td>
            <td>{{loan.type}}</td>
            <td>{{loan.amount}}</td>
            <td><span class="text-success">Approved</span></td>
          </tr>
        </tbody>
      </table>
      <ng-template #noApproved>
        <div class="alert alert-secondary small">No approved loans available.</div>
      </ng-template>
    </div>

    <div id="rejectedLoans" *ngIf="activeTab === 'rejected'">
      <h4>Rejected Loans</h4>
      <table class="table table-bordered" *ngIf="rejectedLoans.length > 0; else noRejected">
        <thead>
          <tr><th>ID</th><th>User</th><th>Type</th><th>Amount</th><th>Status</th></tr>
        </thead>
        <tbody>
          <tr *ngFor="let loan of rejectedLoans">
            <td>{{loan.id}}</td>
            <td>{{getUserName(loan.userId)}}</td>
            <td>{{loan.type}}</td>
            <td>{{loan.amount}}</td>
            <td><span class="text-danger">Rejected</span></td>
          </tr>
        </tbody>
      </table>
      <ng-template #noRejected>
        <div class="alert alert-warning small">No rejected loans at the moment.</div>
      </ng-template>
    </div>

    <div id="repaidLoans" *ngIf="activeTab === 'repaid'">
      <h4>Repaid Loans</h4>
      <table class="table table-bordered" *ngIf="repaidLoans.length > 0; else noRepaid">
        <thead>
          <tr><th>ID</th><th>User</th><th>Type</th><th> Repaid Amount</th><th>Status</th></tr>
        </thead>
        <tbody>
          <tr *ngFor="let loan of repaidLoans">
            <td>{{loan.id}}</td>
            <td>{{getUserName(loan.userId)}}</td>
            <td>{{loan.type}}</td>
            <td>{{getRepaidAmount(loan.id)}}</td>
            <td><span class="text-danger">Repaid</span></td>
          </tr>
        </tbody>
      </table>
      <ng-template #noRepaid>
        <div class="alert alert-warning small">No Repaid loans at the moment.</div>
      </ng-template>
    </div>
  </div>
</div>
