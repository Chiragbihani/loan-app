<div class="container mt-4">
  <h3 class="fw-bold mb-4">Repay Loan</h3>

  <!-- If no active loans -->
  <div *ngIf="activeLoans.length === 0" class="alert alert-info">
    You have no loans to repay at the moment.
  </div>

  <!-- Repay Loan Form -->
  <div class="card shadow-sm mb-4" *ngIf="activeLoans.length > 0">
    <div class="card-body">
      <h5 class="card-title">Make a Repayment</h5>
      <form (ngSubmit)="repayLoan()">
        <!-- Loan Selection -->
        <div class="mb-3">
          <label for="loanId" class="form-label">Select Loan</label>
          <select class="form-select" [(ngModel)]="selectedLoanId" name="loanId" required>
            <option [ngValue]="null" disabled selected>Select a loan</option>
            <option *ngFor="let loan of activeLoans" [value]="loan.id">
              Loan #{{loan.id}} - {{loan.type}} (₹{{loan.amount}})
            </option>
          </select>
        </div>

        <!-- Show repayment info only if a loan is selected -->
        <div *ngIf="selectedLoanId !== null">
          <div class="mb-3">
            <label class="form-label">Repayment Amount</label>
            <input
              type="number"
              class="form-control"
              [value]="getRepaymentAmount()"
              readonly
            />
          </div>

          <div class="mb-3">
            <label class="form-label">Last Repayment Date</label>
            <input
              type="text"
              class="form-control"
              [value]="getRepaymentDate()"
              readonly
            />
          </div>
        </div>

        <!-- Payment Mode -->
        <div class="mb-3">
          <label class="form-label">Payment Mode</label>
          <select class="form-select" [(ngModel)]="paymentMode" name="paymentMode" required>
            <option value="UPI">UPI</option>
            <option value="NetBanking">Net Banking</option>
            <option value="Card">Debit/Credit Card</option>
          </select>
        </div>

        <button class="btn btn-primary" type="submit" [disabled]="!selectedLoanId">
          Confirm Repayment
        </button>
      </form>
    </div>
  </div>

  <!-- Repayment History -->
  <div class="card shadow-sm" *ngIf="repayments.length > 0">
    <div class="card-body">
      <h5 class="card-title">Repayment History</h5>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>ID</th>
            <th>Loan ID</th>
            <th>Amount</th>
            <th>Mode</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let r of repayments">
            <td>{{r.id}}</td>
            <td>{{r.loanId}}</td>
            <td>₹{{r.amount}}</td>
            <td>{{r.mode}}</td>
            <td>{{r.date | date:'short'}}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
