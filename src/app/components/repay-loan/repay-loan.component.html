<div class="container mt-4">

  <!-- If no active loans -->
  <div *ngIf="activeLoans.length === 0" class="alert alert-info">
    You have no loans to repay at the moment.
  </div>

  <!-- Repay Loan Form -->
  <div class="card shadow-sm mb-4" *ngIf="activeLoans.length > 0">
    <div class="card-body">
      <h5 class="card-title">Make a Repayment</h5>
      <form (ngSubmit)="confirmPayment()">
        <!-- Loan Selection -->
        <div class="mb-3">
          <label for="loanId" class="form-label">Select Loan</label>
          <select class="form-select" [(ngModel)]="selectedLoanId" name="loanId" required>
            <option [ngValue]="null" disabled>Select a loan</option>
            <option *ngFor="let loan of activeLoans" [value]="loan.id">
              Loan #{{loan.id}} - {{loan.type | titlecase}} (₹{{loan.amount}})
            </option>
          </select>
        </div>

        <!-- Show repayment info only if a loan is selected -->
        <div *ngIf="selectedLoanId !== null">
          <div class="mb-3">
            <label class="form-label">Repayment Amount</label>
            <input
              type="number"
              class="form-control"
              [value]="getRepaymentAmount()"
              readonly
            />
          </div>

          <div class="mb-3">
            <label class="form-label">Last Repayment Date</label>
            <input
              type="text"
              class="form-control"
              [value]="getRepaymentDate()"
              readonly
            />
          </div>
        </div>

        <!-- Payment Mode -->
        <div class="mb-3">
          <label class="form-label">Payment Mode</label>
          <select class="form-select" [(ngModel)]="paymentMode" name="paymentMode" required>
            <option value="UPI">UPI</option>
            <option value="NetBanking">Net Banking</option>
            <option value="Card">Debit/Credit Card</option>
          </select>
        </div>

        <!-- Payment Details -->
        <div *ngIf="paymentMode === 'UPI'" class="mb-3">
          <label class="form-label">UPI ID</label>
          <input type="text" [(ngModel)]="upiId" name="upiId" class="form-control" placeholder="yourname@upi">
        </div>

        <div *ngIf="paymentMode === 'Card'" class="mb-3">
          <label class="form-label">Card Number</label>
          <input type="text" [(ngModel)]="cardNumber" name="cardNumber" maxlength="16" class="form-control" placeholder="xxxx-xxxx-xxxx-xxxx">

          <label class="form-label mt-2">Expiry</label>
          <input type="text" [(ngModel)]="cardExpiry" name="cardExpiry" class="form-control" placeholder="MM/YY">

          <label class="form-label mt-2">CVV</label>
          <input type="password" [(ngModel)]="cardCvv" name="cardCvv" maxlength="3" class="form-control" placeholder="***">
        </div>

        <div *ngIf="paymentMode === 'NetBanking'" class="mb-3">
          <label class="form-label">Select Bank</label>
          <select [(ngModel)]="bank" name="bank" class="form-select">
            <option value="">-- Select Bank --</option>
            <option>SBI</option>
            <option>HDFC</option>
            <option>ICICI</option>
            <option>Axis Bank</option>
          </select>
        </div>

        <!-- Confirm & Pay -->
        <button class="btn btn-primary" type="submit" [disabled]="!selectedLoanId">
          Proceed to Pay
        </button>
      </form>
    </div>
  </div>

  <!-- Repayment History -->
  <div class="card shadow-sm" *ngIf="repayments.length > 0">
    <div class="card-body">
      <h5 class="card-title">Repayment History</h5>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>ID</th>
            <th>Loan ID</th>
            <th>Amount</th>
            <th>Mode</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let r of repayments">
            <td>{{r.id}}</td>
            <td>{{r.loanId}}</td>
            <td>₹{{r.amount}}</td>
            <td>{{r.mode}}</td>
            <td>{{r.date | date:'short'}}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
